machine:
  pre:
    - curl https://get.docker.com/builds/Linux/x86_64/docker-1.13.0.tgz > docker.tgz
    - tar xf docker.tgz
    - sudo cp docker/docker /usr/local/bin/docker
    - echo 'DOCKER_OPTS="-s btrfs -D"' | sudo tee /etc/default/docker
    - echo 'env container=yes' | sudo tee -a /etc/init/docker.conf
    - docker --version
    - curl --location "https://github.com/docker/compose/releases/download/1.10.1/docker-compose-$(uname -s)-$(uname -m)" > docker-compose
    - chmod +x docker-compose
    - sudo cp docker-compose /usr/local/bin/docker-compose
    - docker-compose --version
  services:
    - docker

dependencies:
  override:
    - docker-compose build

test:
  override:
    - docker-compose run paladin-server stack test
